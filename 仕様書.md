# マスバトール - けいさんバトルRPG 仕様書

## 1. ゲーム概要
計算問題を解くことでモンスターと戦う、10連戦のバトルRPGです。プレイヤーは正しく素早く計算することでモンスターにダメージを与え、全10ステージのクリアを目指します。

## 2. 画面とメニューの仕様

### 2.1 タイトル・セットアップ画面
ゲーム開始前に、以下の設定を行います。
* **なまえ**: プレイヤーの名前を入力します（最大10文字。入力内容は保存されます）。
* **ひだりのけた / みぎのけた**: 計算問題の左側と右側の数字の桁数（1けた・2けた）を選択します。
* **けいさんのしゅるい**: 足し算（＋）、引き算（－）、掛け算（×）、割り算（÷）の中から、出題される計算の種類を複数選択できます。

また、以下のサブメニューへアクセス可能です。
* **モンスターノート**: 倒したモンスターの図鑑を確認できます。
* **アイデアを おくる**: モンスターなどのアイデアを送信できるフォームが開きます。

### 2.2 リザルト画面
全10戦をクリアすると表示されます。
* **合計タイム**: 全モンスターを倒すのにかかった合計時間が表示されます。
* **撃破タイム一覧**: 各モンスターごとの撃破タイムが表示されます。一番早かったタイムは「さいそくタイム」として強調されます。
* **画像拡大**: 各カードをタップすると、モンスターの画像が拡大され、討伐数などの詳細な記録が表示されます。

### 2.3 モンスターノート（図鑑）
* 過去に倒したモンスターが一覧で表示されます。未討伐のモンスターはシルエットと「？？？」で表示されます。
* **カテゴリ分け**: ボス、かいふく、レア、およびステージ番号によって自動で整理されます。
* **セーブ＆ロード機能**: ブラウザの履歴を消しても進行状況を復元できるよう、データをJSON形式で「ほぞん（書き出し）」および「よみこむ（読み込み）」ことができます。
* **改ざん検知**: 保存データにはチェックサム（16進数8桁）が付与され、データの改ざんを検知する機能があります。

## 3. バトルシステム

### 3.1 ターンの進行とタイマー
バトルはプレイヤーとモンスターが交互に行動するターン制です。プレイヤーの最大HPは「10」です。

* **プレイヤーのターン**:
    * 10秒間のタイマーバーが表示されます。
    * 正解した場合、モンスターにダメージを与えます。回答時間が**3.0秒以内**だった場合は「クリティカル」となり、ダメージが増加します。
    * 不正解の場合、攻撃はミスとなり、モンスターのターンに移行します。
* **モンスターのターン**:
    * 20秒間のタイマーバーが表示されます。
    * 正解した場合、モンスターの攻撃を「よけた」ことになり、ダメージを受けずに再びプレイヤーのターンに戻ります。
    * 不正解、または20秒経過した場合、モンスターからダメージを受けます。

### 3.2 連続回避と必殺技
* モンスターターンの問題に正解（攻撃を回避）するたびに、プレイヤーにオーラが溜まります。
* 4回連続で回避するとオーラが最大になり、「必殺技」が発動可能な状態になります。
* 必殺技待機状態でプレイヤーが正解すると、与えるダメージが**2倍**になります。
* ダメージを受けたり時間切れになると、オーラはリセットされます。

### 3.3 ダメージの計算
* **プレイヤーの攻撃**:
    * 通常正解：(1ダメージ × クリティカル補正) ＋ 武器のボーナス
    * クリティカル（3秒以内）：補正として基本ダメージが2倍
    * 必殺技発動時：上記最終計算結果を2倍
* **モンスターの攻撃**:
    * モンスターの攻撃力 － 盾の軽減値 ＝ 受けるダメージ

### 3.4 計算問題の出題仕様
* **足し算 / 引き算**: 指定した桁数でランダムに出題されます。引き算の答えがマイナスになることはありません。
* **掛け算**: 指定した桁数でランダムに出題されます。
* **割り算**: 必ず割り切れる問題が出題され、答え（商）は「2」以上（ボスの場合は「5」以上）になります。
* **ボスの問題**: 足し算・引き算は必ず「繰り上がり・繰り下がり」が発生する問題になります。

## 4. 装備とアイテムドロップ
特定のモンスターを倒すと、武器（けん）や防具（たて）を自動的に入手・装備します。

### 4.1 武器（けん）
1. **ぼう**（初期）：ボーナス +0
2. **どうのけん**：ボーナス +1
3. **てつのけん**：ボーナス +2
4. **はがねのけん**：ボーナス +3
5. **きんのけん**：ボーナス +4

### 4.2 防具（たて）
盾はダメージを軽減しますが、攻撃を防ぐたびに耐久度が減り、0になると壊れてなくなります。
1. **きのたて**：軽減 1 / 耐久 1回
2. **どうのたて**：軽減 2 / 耐久 2回
3. **てつのたて**：軽減 3 / 耐久 3回
4. **はがねのたて**：軽減 4 / 耐久 4回
5. **きんのたて**：軽減 5 / 耐久 5回

### 4.3 ドロップ率
現在の所持レベルに応じて、次の段階の装備が落ちる確率が設定されています。

| 現在のレベル | 剣のドロップ率 | 盾のドロップ率 |
| :--- | :--- | :--- |
| レベル0 (なし/ぼう) | 60% | 40% |
| レベル1 | 40% | 25% |
| レベル2 | 20% | 15% |
| レベル3 | 10% | 7% |
| レベル4 | 4% | 3% |
| レベル5 | 0% (最大) | 0% (最大) |

## 5. モンスターの仕様と特殊行動

### 5.1 ステージ進行
* **1〜4戦目**: 攻撃力 1 / HPはステージ数と同じ（最大HP 4）
* **5〜7戦目**: 攻撃力 2 / HPはステージ数と同じ（最大HP 7）
* **8〜9戦目**: 攻撃力 3 / HPはステージ数と同じ（最大HP 9）
* **10戦目（ボス）**: 攻撃力 4 / HPは難易度設定により 10, 12, 14, 16 のいずれか

### 5.2 特殊モンスター
* **レアモンスター**: 出現率 約2%。倒すと剣・盾のアップグレード（2段階上が可能なら2段階、そうでなければ1段階）が確定でドロップします。
* **回復モンスター**: HPが半分以下の時に20%の確率で出現。倒すとプレイヤーのHPが全回復し、盾が確定でドロップします。

### 5.3 ボスモンスター（10戦目）
* **特定ボスの行動**:
    * **モンスター #15**: HPが5未満になると「肉」を食べ、HPを16まで回復させます（一度のみ）。
    * **モンスター #16**: HPが6以下になると「樹液」を舐め、HPを16まで回復させます（一度のみ）。
* **真の姿（最高難易度）**:
    * モンスター #16がHP 4以下になると変身。HP 20に全回復し、攻撃力が 10 に上昇します。名称が「しんのかみ」に変化します。