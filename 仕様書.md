# 【開発仕様書】小学生向け計算RPG

## 1. プロジェクト概要
* **プロジェクト名:** 計算君（Web版）
* **目的:** ドラゴンクエスト風の戦闘画面を通じて、小学生が楽しく四則演算を学べるWebアプリケーション。
* **ターゲット:** スマートフォン、タブレット、PCブラウザ
* **技術スタック:** HTML5, CSS3, Vanilla JavaScript (フレームワーク不使用)

## 2. ディレクトリ構成
```
計算君Web版/
  ├── index.html      # アプリケーションのエントリーポイント
  ├── style.css       # スタイル定義（レスポンシブ対応）
  ├── script.js       # ゲームロジック
  ├── 仕様書.md       # 本ドキュメント
  └── assets/         # リソース
       ├── img/       # モンスター画像 (*.png)
       └── audio/     # 音声ファイル (BGM: *.mp3, SE: *.wav)
```

## 3. ゲームフローと画面仕様

### フェーズ1：初期設定（Setup Screen）
* **入力項目:**
    1.  **勇者の名前:** 最大10文字（デフォルト: "ゆうしゃ"）。
    2.  **左辺の桁数:** 1桁 / 2桁（ボタン選択）。
    3.  **右辺の桁数:** 1桁 / 2桁（ボタン選択）。
    4.  **計算の種類:** 足し算、引き算、掛け算、割り算（複数選択可）。
* **その他の機能:** 「アイデアを おくる」ボタンからGoogleフォーム経由で要望やフィードバックを送信可能。
* **開始:** 「バトルスタート」ボタン押下。

### フェーズ2：インターバル（Interval Overlay）
* 次のモンスターの名称と**画像**を表示。
* 「たたかう」ボタンでバトル画面へ遷移。
* **BGM:**
    * 通常モンスター: 通常戦闘曲（`battle.mp3`）
    * ラスボス（#10）: ボス曲（`Bossbattle.mp3`）

### フェーズ3：バトル画面（Battle Screen）
* **レイアウト:**
    * **縦画面（スマホ）:** 上部にモンスター、下部に操作パネル。
    * **横画面（タブレット/PC）:** 左にモンスター、右に操作パネル（ランドスケープモード）。
* **表示要素:**
    * モンスター画像（HPに応じて変動なし、特定ボスのみ変身あり）。
    * モンスターHPバー。
    * 勇者ステータス（名前、装備状態の表示(剣アイコン等)、HPバー: 最大10）。
    * **制限時間バー:** 10秒カウントダウン。
    * **計算問題:** `5 + 3 = ?` 形式。
    * **入力フォーム:** 数値入力用。
    * **テンキー:** 画面上のタッチ操作用キーパッド。
* **操作:**
    * 物理キーボード（PC）または画面上のテンキーで数値を入力。
    * Enterキーまたは「GO」ボタンで回答。

### フェーズ4：リザルト画面（Result Screen）
* 全モンスター撃破時に表示。
* 各モンスターの撃破タイム一覧を表示。
* **画像拡大機能:** リザルト画面のモンスター画像をクリックするとモーダルで拡大表示（Image Zoom Modal）。
* 「タイトルにもどる」ボタンで初期設定へ。

## 4. 詳細機能要件

### A. 計算ロジック
* **出題生成:** 設定された桁数と演算子に基づいてランダム生成。
* **割り算:** 必ず「割り切れる整数」が解となる問題のみ生成（余りなし）。また、答えが「1」や右辺が「1」になる問題は出題しない。
* **引き算:** 答えが「負の数」にならないよう、必ず `左辺 >= 右辺` に調整。
* **掛け算・足し算:** 指定桁数に従う。

### B. バトルシステム
* **モンスター仕様:**
    * ステージ数: アセットフォルダ内の画像ファイル名に基づいて動的に計算される（基本は全10戦）。
    * HP: モンスター番号に準拠（1体目はHP1... 10体目はHP10）。レア/回復モンスターはHP1。
    * 攻撃力: 序盤1、中盤2、終盤3、ラスボス4。
* **クリティカル（タイムボーナス）:**
    * 出題から**3秒以内**に正解: **2ダメージ**（クリティカル演出）。
    * 3秒以降に正解: **1ダメージ**。
* **プレイヤーHP:**
    * 最大10。誤答時のみダメージを受ける。
    * 誤答時のダメージはモンスターの攻撃力に依存。
    * HP0でゲームオーバー（リロードで最初から）。
* **撃破後の処理:**
    * トドメの一撃 → ダメージ表示(1.5秒) → 撃破演出 → 次のモンスターへ。
    * この間、入力はブロックされる。
    * **アイテムドロップ:** 1～9戦目の通常モンスター（レア・回復は除く）撃破時に判定。
        * **ぼう:**        最初から装備している 
        * **はがねのけん:**15%の確率でドロップ。獲得後、永続的に与ダメージが＋1される。
        * **はがねのたて:** けんと同時にドロップはしない（けんの判定が優先）。けんが落ちなかった場合、8%の確率でドロップ。装備後は全ての被ダメージを最後に-1減衰する。被ダメージの減衰を5回行うと「はがねのたてはこわれてしまった！」と表示され、効果とアイコンが消失する。

### C. 特殊イベント（ボス・隠し要素）
1.  **レアモンスター:** 2〜9戦目で**2%の確率**で出現。撃破すると**攻撃力2倍**のバフ獲得。
2.  **回復モンスター:** プレイヤーHPが半分以下の時、**20%の確率**で出現。撃破で**HP全回復**。
3.  **ボスモンスター（10戦目）:**
    * 設定（左辺桁数、右辺桁数、演算子の種類数）に応じて全16種類のボスから1体が選出される。
    * **基本ルール:**
        * ID = (左辺桁数/右辺桁数に基づくオフセット) + (演算子数)
        * 画像がない場合は汎用ボス画像（10_）を表示、それもない場合は非表示。

    | ID | 左辺 | 右辺 | 演算子数 | 備考 |
    |:---|:---|:---|:---|:---|
    | Boss01-04 | 1桁 | 1桁 | 1~4つ | HP: 10 |
    | Boss05-08 | 1桁 | 2桁 | 1~4つ | HP: 12 |
    | Boss09-12 | 2桁 | 1桁 | 1~4つ | HP: 14 |
    | Boss13-16 | 2桁 | 2桁 | 1~4つ | ボス15・16は特殊イベント (HP: 16) |

4.  **特殊イベント付きボス:**
    * **Boss 15（ティラノ）:** HP5未満で「肉を食べる」イベント発生（HP16に回復）。
    * **Boss 16（カブトサムライ）:**
        * HP6以下: 「樹液を舐める」（HP16に回復）。
        * HP4以下: 「真の姿（しんのかみ）」に変身し、**最大HPと現在HPが20に変更され、攻撃力も10に急増する**。画像も専用の「しんのかみダイオウグソクナイト」に変化する。

### D. 演出要件（VFX/Sound）
* **攻撃ヒット:** モンスター画像が高速点滅（フラッシュなし）。
* **被ダメージ:** 画面全体が激しく揺れる（シェイク）。
* **撃破:** モンスター画像がフェードアウト。
* **SE/BGM:** 状況に応じて再生。