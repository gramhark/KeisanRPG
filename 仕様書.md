# マスバトール - けいさんバトルRPG 仕様書

## 1. ゲーム概要
計算問題を解くことでモンスターと戦う、10連戦のバトルRPGです。プレイヤーは正しく素早く計算することでモンスターにダメージを与え、全10ステージのクリアを目指します。

## 2. 画面とメニューの仕様

### 2.1 タイトル・セットアップ画面
ゲーム開始前に、以下の設定を行います。
* **なまえ**: プレイヤーの名前を入力します（最大10文字。入力内容は保存されます）。
* **ひだりのけた / みぎのけた**: 計算問題の左側と右側の数字の桁数（1けた・2けた）を選択します。
* **けいさんのしゅるい**: 足し算（＋）、引き算（－）、掛け算（×）、割り算（÷）の中から、出題される計算の種類を複数選択できます。

また、以下のサブメニューへアクセス可能です。
* **モンスターノート**: 倒したモンスターの図鑑を確認できます。
* **アイデアを おくる**: モンスターなどのアイデアを送信できるフォームが開きます。

### 2.2 リザルト画面
全10戦をクリアすると表示されます。
* **合計タイム**: 全モンスターを倒すのにかかった合計時間が表示されます。
* **撃破タイム一覧**: 各モンスターごとの撃破タイムが表示されます。一番早かったタイムは「さいそくタイム」として強調されます。
* **画像拡大**: 各カードをタップすると、モンスターの画像が拡大され、討伐数などの詳細な記録が表示されます。

### 2.3 モンスターノート（図鑑）
* 過去に倒したモンスターが一覧で表示されます。未討伐のモンスターはシルエットと「？？？」で表示されます。
* **カテゴリ分け**: ボス、かいふく、レア、およびステージ番号によって自動で整理されます。
* **セーブ＆ロード機能**: ブラウザの履歴を消しても進行状況を復元できるよう、データをJSON形式で「ほぞん（書き出し）」および「よみこむ（読み込み）」ことができます。チェックサムによる改ざん検知機能付きです。

## 3. バトルシステム

### 3.1 ターンの進行とタイマー
バトルはプレイヤーとモンスターが交互に行動するターン制です。プレイヤーの最大HPは「10」です。

* **プレイヤーのターン**:
    * 10秒間のタイマーバーが表示されます。
    * 正解した場合、モンスターにダメージを与えます。回答時間が**3.0秒以内**だった場合は「クリティカル」となり、ダメージが増加します。
    * 不正解の場合、攻撃はミスとなり、モンスターのターンに移行します。
* **モンスターのターン**:
    * タイマーは表示されません。
    * 正解した場合、モンスターの攻撃を「よけた」ことになり、ダメージを受けずに再びプレイヤーのターンに戻ります。
    * 不正解の場合、モンスターからダメージを受けます。

### 3.2 ダメージの計算
* **プレイヤーの攻撃**:
    * 通常正解：1ダメージ ＋ 武器のボーナス
    * クリティカル（3秒以内）：2ダメージ ＋ 武器のボーナス
    * ※レアモンスター討伐後は、上記の最終ダメージが2倍になります。
* **モンスターの攻撃**:
    * モンスターの攻撃力 － 盾の軽減値 ＝ 受けるダメージ

### 3.3 計算問題の出題仕様
* **足し算 / 引き算**: 指定した桁数でランダムに出題されます。引き算の答えがマイナスになることはありません。
* **掛け算**: 指定した桁数でランダムに出題されます。
* **割り算**: 必ず割り切れる問題が出題され、答え（商）は「2」以上になります。
* **文字の自動調整**: 桁数が多い場合でも画面からはみ出さないよう、文字間隔が自動で調整されます。

## 4. 装備とアイテムドロップ
特定のモンスターを倒すと、武器（つるぎ）や防具（たて）を自動的に入手・装備します。

### 4.1 武器（つるぎ）
1. **ぼう**（初期）：ボーナス +0
2. **どうのつるぎ**：ボーナス +1
3. **てつのつるぎ**：ボーナス +2
4. **はがねのつるぎ**：ボーナス +3

### 4.2 防具（たて）
盾はダメージを軽減しますが、攻撃を防ぐたびに耐久度が減り、0になると壊れてなくなります。
1. **きのたて**：軽減 1 / 耐久 1回
2. **どうのたて**：軽減 2 / 耐久 2回
3. **てつのたて**：軽減 3 / 耐久 3回
4. **はがねのたて**：軽減 4 / 耐久 4回

### 4.3 ドロップ率（通常時）
現在のレベルに応じて、次の装備が落ちる確率が設定されています。

| 現在のレベル | 剣のドロップ率 | 盾のドロップ率 |
| :--- | :--- | :--- |
| なし / ぼう | 50% | 30% |
| レベル1 | 25% | 20% |
| レベル2 | 12% | 10% |
| レベル3 | 0% (最大) | 5% |
| レベル4 | - | 0% (最大) |

## 5. モンスターの仕様と特殊行動

### 5.1 ステージ進行
* **1〜4戦目**: 攻撃力 1 / HPはステージ数と同じ（最大HP 4）
* **5〜7戦目**: 攻撃力 2 / HPはステージ数と同じ（最大HP 7）
* **8〜9戦目**: 攻撃力 3 / HPはステージ数と同じ（最大HP 9）

### 5.2 特殊モンスター
* **レアモンスター**: 出現率 約2%。倒すと攻撃力が2倍になり、剣・盾のアップグレードが確定でドロップします。
* **回復モンスター**: HPが半分以下の時に20%の確率で出現。倒すとプレイヤーのHPが全回復し、盾が確定でドロップします。

### 5.3 ボスモンスター（10戦目）
設定した難易度（桁数・演算子数）によって最大HPが10〜16の間で変動します。
* **ボスの問題**: 足し算・引き算は必ず「繰り上がり・繰り下がり」が発生する問題になります。
* **肉・樹液**: 特定のボスはHPが減ると回復アイテムを使用し、一度だけHPを全回復します。
* **真の姿（最高難易度）**: HPが4以下になると変身。HPが20に全回復し、攻撃力が10に跳ね上がります。